services:
  # Container: LOCAL_Docker - SMSC on 2775-2777, ESME clients to host.docker.internal:2778-2780
  # Pair with IntelliJ instance running LOCAL_Docker2 (SMSC on 2778-2780, ESME to localhost:2775-2777)
  simulator-1:
    build:
      context: ../../..
      dockerfile: src/app_requirements/test_containers/Dockerfile
    container_name: smpp-simulator-1
    hostname: simulator-1
    ports:
      - "8021:8020"   # Web UI
      - "9002:9001"   # Additional application port
      - "2775:2775"   # SMSC Receiver - IntelliJ ESME will connect here
      - "2776:2776"   # SMSC Transmitter
      - "2777:2777"   # SMSC Transceiver
    environment:
      - SPRING_PROFILES_ACTIVE=local
      - CURRENTENV=LOCAL_Docker
      - CLOUDHOPPERENABLED=false
#      - CLOUDHOPPER_ENABLED=false
      - PORT=8020
      # Container uses smpps_container.xml which has host.docker.internal for ESME connections
      - SMPP_CONFIG_FILE=smpps_container.xml
    volumes:
      - ../../main/resources/com/telemessage/simulators/LOCAL_Docker:/app/LOCAL_Docker:ro
    extra_hosts:
      # Enable host.docker.internal on Linux Docker (Windows/Mac have it by default)
      - "host.docker.internal:host-gateway"
    networks:
      smpp-network:
        ipv4_address: 172.25.0.10
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8020/actuator/health"]
      interval: 15s
      timeout: 5s
      retries: 5
      start_period: 30s
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  smpp-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.25.0.0/16
          gateway: 172.25.0.1
